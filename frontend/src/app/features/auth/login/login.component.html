<div
  class="login-page d-flex align-items-center justify-content-center min-vh-100"
>
  <!-- Theme toggle -->
  <div class="theme-switcher position-fixed top-0 end-0 m-3">
    <div class="btn-group" role="group">
      <button
        class="btn btn-sm"
        [class.btn-primary]="themeService.theme() === 'light'"
        [class.btn-outline-secondary]="themeService.theme() !== 'light'"
        (click)="themeService.setTheme('light')"
        title="Light theme"
      >
        <i class="bi bi-sun-fill"></i>
      </button>
      <button
        class="btn btn-sm"
        [class.btn-primary]="themeService.theme() === 'dark'"
        [class.btn-outline-secondary]="themeService.theme() !== 'dark'"
        (click)="themeService.setTheme('dark')"
        title="Dark theme"
      >
        <i class="bi bi-moon-fill"></i>
      </button>
      <button
        class="btn btn-sm"
        [class.btn-primary]="themeService.theme() === 'auto'"
        [class.btn-outline-secondary]="themeService.theme() !== 'auto'"
        (click)="themeService.setTheme('auto')"
        title="Auto theme"
      >
        <i class="bi bi-circle-half"></i>
      </button>
    </div>
  </div>

  <div class="login-card card shadow-lg border-0">
    <!-- Logo & Branding -->
    <div class="card-header text-center py-4 border-0 logo-header">
      <div class="logo-container mb-3">
        <svg
          width="72"
          height="72"
          viewBox="0 0 200 200"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle
            cx="100"
            cy="100"
            r="96"
            fill="#0D1B2A"
            stroke="#2E7FCF"
            stroke-width="2"
          />
          <ellipse
            cx="100"
            cy="172"
            rx="72"
            ry="10"
            fill="#1B4D7E"
            opacity="0.5"
          />
          <path
            d="M28 165 Q64 155 100 165 Q136 175 172 165"
            stroke="#2E7FCF"
            stroke-width="2.5"
            fill="none"
            stroke-linecap="round"
          />
          <rect x="30" y="155" width="140" height="12" rx="3" fill="#1B4D7E" />
          <rect x="62" y="60" width="12" height="97" rx="2" fill="#2E7FCF" />
          <rect x="62" y="60" width="96" height="10" rx="2" fill="#2E7FCF" />
          <rect x="30" y="60" width="34" height="8" rx="2" fill="#1B4D7E" />
          <rect x="22" y="55" width="16" height="18" rx="3" fill="#1B4D7E" />
          <line
            x1="158"
            y1="65"
            x2="68"
            y2="40"
            stroke="#E8A020"
            stroke-width="1.5"
            opacity="0.8"
          />
          <line
            x1="140"
            y1="65"
            x2="68"
            y2="40"
            stroke="#E8A020"
            stroke-width="1.2"
            opacity="0.6"
          />
          <rect x="56" y="35" width="24" height="28" rx="3" fill="#1B4D7E" />
          <circle
            cx="68"
            cy="49"
            r="7"
            fill="#0D1B2A"
            stroke="#E8A020"
            stroke-width="2"
          />
          <circle cx="68" cy="49" r="3" fill="#E8A020" opacity="0.8" />
          <line
            x1="150"
            y1="70"
            x2="150"
            y2="128"
            stroke="#E8A020"
            stroke-width="2"
            stroke-dasharray="4,3"
          />
          <rect x="128" y="128" width="44" height="26" rx="3" fill="#E8A020" />
          <line
            x1="143"
            y1="128"
            x2="143"
            y2="154"
            stroke="#C07010"
            stroke-width="1.5"
          />
          <line
            x1="157"
            y1="128"
            x2="157"
            y2="154"
            stroke="#C07010"
            stroke-width="1.5"
          />
          <rect x="128" y="128" width="44" height="5" rx="2" fill="#F0B030" />
          <circle
            cx="50"
            cy="157"
            r="5"
            fill="#2E7FCF"
            stroke="#0D1B2A"
            stroke-width="1.5"
          />
          <circle
            cx="86"
            cy="157"
            r="5"
            fill="#2E7FCF"
            stroke="#0D1B2A"
            stroke-width="1.5"
          />
          <rect x="56" y="100" width="24" height="20" rx="3" fill="#1B4D7E" />
          <rect
            x="59"
            y="103"
            width="18"
            height="11"
            rx="2"
            fill="#B0D4F1"
            opacity="0.85"
          />
          <circle cx="168" cy="30" r="2.5" fill="#E8A020" />
        </svg>
      </div>
      <h1 class="fw-bold mb-0 brand-title">Portalcrane</h1>
      <p class="text-muted small mb-0">Docker Registry Manager</p>
    </div>

    <div class="card-body p-4">
      <!-- OIDC Login -->
      @if (oidcConfig()?.enabled) {
        <div class="mb-3">
          <button
            class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2"
            (click)="loginWithOidc()"
          >
            <i class="bi bi-person-badge-fill"></i>
            Sign in with {{ oidcConfig()?.issuer | slice: 8 : 40 }}...
          </button>
        </div>
        <div class="divider d-flex align-items-center my-3">
          <span class="divider-line"></span>
          <span class="text-muted small px-2">or admin login</span>
          <span class="divider-line"></span>
        </div>
      }

      <!-- Local Login Form -->
      <form (submit)="onSubmit($event)">
        <div class="mb-3">
          <label class="form-label fw-semibold small">Username</label>
          <div class="input-group">
            <span class="input-group-text"
              ><i class="bi bi-person-fill"></i
            ></span>
            <input
              type="text"
              class="form-control"
              placeholder="admin"
              autocomplete="username"
              [formField]="loginForm.username"
            />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold small">Password</label>
          <div class="input-group">
            <span class="input-group-text"
              ><i class="bi bi-lock-fill"></i
            ></span>
            <input
              [type]="showPassword() ? 'text' : 'password'"
              class="form-control"
              [formField]="loginForm.password"
              placeholder="••••••••"
              autocomplete="current-password"
            />
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="showPassword.set(!showPassword())"
            >
              <i [class]="showPassword() ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
            </button>
          </div>
        </div>

        @if (error()) {
          <div
            class="alert alert-danger d-flex align-items-center gap-2 py-2"
            role="alert"
          >
            <i class="bi bi-exclamation-triangle-fill"></i>
            <small>{{ error() }}</small>
          </div>
        }

        <button
          type="submit"
          class="btn btn-primary w-100 d-flex align-items-center justify-content-center gap-2"
          [disabled]="loading() || loginForm().invalid()"
        >
          @if (loading()) {
            <span class="spinner-border spinner-border-sm"></span>
            Signing in...
          } @else {
            <i class="bi bi-box-arrow-in-right"></i>
            Sign In
          }
        </button>
      </form>
    </div>

    <div class="card-footer text-center text-muted small py-2 border-0">
      <i class="bi bi-shield-lock"></i> Secured access to Docker Registry
    </div>
  </div>
</div>
